<%- include('../layout/user/header.ejs') -%>

    <div class="pageWrapper">
        <%-include('../partials/userNavbar')-%>

            <!--Body Content-->
            <div id="page-content">
                <!--Page Title-->
                <div class="page section-header text-center">
                    <div class="page-title">
                        <div class="wrapper">
                            <h1 class="page-width">Checkout</h1>
                        </div>
                    </div>
                </div>
                <!--End Page Title-->
                <div class="container">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                            <div class="customer-box returning-customer">
                                <h3><i class="icon anm anm-user-al"></i> Do want add new address? <a href="#addAddress"
                                        id="customer" class="text-white text-decoration-underline"
                                        data-toggle="collapse">Add New
                                        address</a></h3>
                                <!-- <h3><i class="icon anm anm-user-al"></i> Do want add new address? <a href="#customer-login" id="customer" class="text-white text-decoration-underline" data-toggle="collapse">Add New address</a></h3> -->
                                <div id="addAddress" class="create-ac-content bg-light-gray padding-20px-all collapse ">
                                    <form action="/add-address" method="post" onsubmit="return addAddressValidation()">
                                        <fieldset>
                                            <h2 class="login-title mb-3">Delivery Address</h2>
                                            <div id="error-container" class="text-center text-danger"></div>
                                            <div class="row">
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-firstname">Full Name <span
                                                            class="required-f">*</span></label>
                                                    <input name="name" value="" id="input-firstname" type="text">
                                                </div>
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-telephone">Mobile <span
                                                            class="required-f">*</span></label>
                                                    <input name="mobile" value="" id="input-telephone" type="text">
                                                </div>
                                            </div>

                                        </fieldset>

                                        <fieldset>
                                            <div class="row">
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-address-1">Address <span
                                                            class="required-f">*</span></label>
                                                    <input name="address" value="" id="input-address-1" type="text">
                                                </div>
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-city">City <span
                                                            class="required-f">*</span></label>
                                                    <input name="city" value="" id="input-city" type="text">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6">
                                                    <label for="input-district">District <span
                                                            class="required-f">*</span></label>
                                                    <input name="district" value="" id="input-district" type="text">
                                                </div>
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-zone">State <span
                                                            class="required-f">*</span></label>
                                                    <select name="state" id="input-zone">
                                                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala" selected>Kerala</option>
                                                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                        <option value="Andaman and Nicobar Islands">Andaman and
                                                            Nicobar
                                                            Islands</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Dadra and Nagar Haveli">Dadra and Nagar
                                                            Haveli
                                                        </option>
                                                        <option value="Daman and Diu">Daman and Diu</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                    </select>

                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-postcode">Post Code <span
                                                            class="required-f">*</span></label>
                                                    <input name="pincode" value="" id="input-postcode" type="text">
                                                </div>
                                                <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                                    <label for="input-country">Country <span
                                                            class="required-f">*</span></label>
                                                    <select name="country" id="input-country">
                                                        <option value="India" selected>India</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </fieldset>


                                        <fieldset>
                                            <div class="row d-flex justify-content-center">
                                                <button type="submit" class="btn">submit</button>
                                            </div>
                                        </fieldset>
                                    </form>
                                </div>

                            </div>
                        </div>

                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                            <div class="customer-box customer-coupon">
                                <h3 class="font-15 xs-font-13"><i class="icon anm anm-gift-l"></i> Have a coupon? <a
                                        href="#have-coupon" class="text-white text-decoration-underline"
                                        data-toggle="collapse">Click here to enter your code</a></h3>
                                <div id="have-coupon" class="collapse coupon-checkout-content">
                                    <div class="discount-coupon">
                                        <div id="coupon" class="coupon-dec tab-pane active">
                                            <p class="margin-10px-bottom">Enter your coupon code if you have one.
                                            </p>
                                            <label class="required get" for="coupon-code"><span
                                                    class="required-f">*</span>
                                                Coupon</label>

                                            <% if(cartData?.couponApplied){ %>
                                                <input id="coupon-code" required="" type="text" class="mb-3" disabled>
                                                <% } else { %>
                                                    <input id="coupon-code" required="" type="text" class="mb-3 ">
                                                    <% } %>

                                                        <button class="coupon-btn btn" type="button"
                                                            id="apply-coupon">Apply
                                                            Coupon</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row billing-fields">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 sm-margin-30px-bottom">

                            <div class="d-flex justify-content-between">
                                <div class="text-left pl-2">
                                    <% if (userData){%>
                                        <%if(userData.addresses.length>0){%>
                                            <h3>Choose a delivery address </h3>
                                            <%}else{%>
                                                <h3>Please add delivery address </h3>
                                                <%}%>
                                </div>
                                <div class="text-right pr-2 pb-1">

                                    <% if(cartData?.couponApplied){%>
                                        <button class="btn btn-dark rounded-pill" id="coupon-remove-button">
                                            remove coupon
                                        </button>
                                        <% }else{ %>
                                            <button class="btn btn-dark rounded-pill" id="cancel-button" data-orderId=""
                                                data-toggle="modal" data-target="#customizedModal">
                                                view coupons
                                            </button>
                                            <% } %>

                                </div>
                            </div>
                            <div id='addressError' class="text-danger"></div>

                            <% userData.addresses.forEach((address, index)=>{%>
                                <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
                                    <span> <input type="radio" <%=index==0?"checked":null%> id="address-<%= index %>
                                            "
                                            name="selectedAddress"
                                            value="<%= index %>">
                                                <label for="address-<%= index %>"></label></span>
                                    <h3>
                                        <%= address.name %>
                                    </h3>
                                    <p>
                                        <%= address.address %>,<%= address.place %>
                                                <br>
                                                <%= address.city %>
                                                    <%= address.district %>
                                                        <br>
                                                        <%= address.state %>
                                                            <%= address.country %>
                                                                <br>
                                                                <%= address.mobile %> <br>

                                    </p>


                                    <!-- Add radio button for each address -->
                                </div>
                                <%})%>
                                    <%}%>

                        </div>

                        <% if(cartData){%>
                            <% console.log('cartData from checkout ejs====',cartData)%>
                           
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <div class="your-order-payment">
                                        <div class="your-order">
                                            <h2 class="order-title mb-4" id="order" cartId="<%=cartData._id%>">Your Order
                                            </h2>

                                            <div class="table-responsive-sm order-table">

                                                <table class="bg-white table table-bordered table-hover text-center">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-left">Product Name</th>
                                                            <th>Price</th>
                                                            <th>Qty</th>
                                                            <th>Amount</th>
                                                        </tr>
                                                    </thead>
                                                    <% let subtotal=0 %>
                                                        <% cartData.products.forEach((product,index)=>{%>
                                                            <tbody>

                                                                <tr>
                                                                    <td class="text-left">
                                                                        <%= product.productId.name %>
                                                                    </td>
                                                                    <td>₹ <%= product.offerPrice%>.00</td>

                                                                    <td>
                                                                        <%= product.quantity %>
                                                                    </td>
                                                                    <td>₹ <%= product.offerPrice * product.quantity %>.00
                                                                    </td>
                                                                </tr>

                                                                <% subtotal+=product.offerPrice * product.quantity %>
                                                            </tbody>
                                                            <% })%>
                                                                <tfoot class="font-weight-600">
                                                                    <tr>
                                                                        <td colspan="3" class="text-right">Shipping
                                                                        </td>
                                                                        <td>₹ 0.00</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3" class="text-right">Subtotal
                                                                        </td>
                                                                        <td>₹ <%= subtotal%>.00</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3" class="text-right">Coupon Discount
                                                                        </td>
                                                                        <td id="discountId">₹ <%= cartData?.coupon?.couponDiscount ? cartData?.coupon?.couponDiscount :0 %>.00</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <%let totalAmount%>
                                                                        <%if(cartData?.coupon?.couponDiscount){%>
                                                                            <% totalAmount = subtotal-cartData?.coupon?.couponDiscount%>
                                                                            <%}else{%>
                                                                                 <% totalAmount = subtotal%>
                                                                            <%}%>

                                                                        <td colspan="3" class="text-right font-weight-bold fs-5">Total</td>
                                                                        <td id="sub-total" class="font-weight-bold fs-5"
                                                                            data-subtotal="<%= totalAmount%>">₹
                                                                            <%= totalAmount %>.00
                                                                        </td>
                                                                    </tr>
                                                                </tfoot>
                                                </table>

                                            </div>
                                        </div>

                                        <hr />

                                        <div class="your-payment">
                                            <h2 class="payment-title mb-3">payment method</h2>
                                            <div class="payment-method">
                                                <div class="payment-accordion">
                                                    <div id="accordion" class="payment-section">
                                                        <div id='paymentError' class="text-danger">
                    </div>
                    <%if(totalAmount>=1000){%>
                        <div class="card mb-2">
                            <div class="card-header d-flex ">
                                <input class="mr-2" type="radio" name="paymentOption" id="cashOnDelivery" value="COD">
                                <label class="card-link" for="cashOnDelivery">Cash on
                                    Delivery</label>
                            </div>
                        </div>
                        <%}%>

                            <div class="card mb-2">
                                <div class="card-header d-flex ">
                                    <input class="mr-2" type="radio" name="paymentOption" value="Online"
                                        id="Online_Payment">
                                    <label class="card-link" for="Online">Online
                                        Payment</label>
                                </div>
                            </div>

                            <div class="card mb-2">
                                <div class="card-header d-flex ">
                                    <input class="mr-2" type="radio" name="paymentOption" value="Wallet" id="wallet">
                                    <label class="card-link" for="Wallet">Wallet(₹ <%=wallet?.balance%>.00)</label>
                                </div>
                            </div>

                </div>
            </div>
            <div class="order-button-payment">
                <button class="btn" value="Place order" id="place-order" type="submit"
                    onclick="checkoutValidation()">Place
                    order</button>
            </div>
    </div>
    </div>
    </div>
    </div>
    <%}%>
        </div>
        </div>
        </div>
        <!--End Body Content-->

        <div class="modal fade" id="customizedModal" tabindex="-1" role="dialog" aria-labelledby="customizedModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered  modal-dialog-scrollable" style="max-width: 500px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Available Coupons</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="height: 350px; overflow: auto;">
                        <div class="form-group">
                            <table class="table" id="myTable">
                                <thead>
                                    <tr>
                                        <th class="mx-2 text-dark font-weight-bold fs-5">Name</th>
                                        <th class="mx-2 text-dark font-weight-bold fs-5">Offer</th>
                                        <th class="mx-2 text-dark font-weight-bold fs-5">Valid upto
                                        </th>
                                        <th class="mx-2 text-dark font-weight-bold fs-5">Min Order
                                        </th>
                                        <th class="mx-2 text-dark font-weight-bold fs-5">Coupon code
                                        </th>
                                    </tr>
                                </thead>

                                <tbody>
                                    <%if(Array.isArray(viewCoupons) && viewCoupons.length> 0){%>
                                        <%viewCoupons.forEach( coupon=> { %>
                                            <%console.log("coupon-------------------------------",coupon)%>

                                                <tr>
                                                    <td class="text-center m-2">
                                                        <%=coupon.title%>
                                                    </td>
                                                    <td class=" text-center m-2"><span class="text-success"> Offer :
                                                            <%=coupon.discount%> %
                                                        </span></td>
                                                    <% const formattedDate=coupon.expiryDate.toLocaleString('en-US', {
                                                        month: 'short' , day: 'numeric' , year: 'numeric' }); %>

                                                        <td class="text-center m-2">
                                                            <%=formattedDate%>
                                                        </td>
                                                        <td class="text-center m-2"> ₹
                                                            <%=coupon.minCost%>
                                                        </td>
                                                        <td class="text-center  m-2">
                                                            <div class="coupon-container">
                                                                <span style="font-size: 12px;">click to
                                                                    copy</span>
                                                                <div class="p-1 rounded-pill btn "
                                                                    style="background-color: rgb(117, 117, 117);">
                                                                    <div class="coupon-code  fs-5"
                                                                        style="color: rgb(255, 255, 255); font-weight: 400; cursor: pointer;">
                                                                        <%=coupon.couponCode%>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </td>
                                                </tr>

                                                <%})%>
                                                    <%}else{%>
                                                        <tr>
                                                            <td class="text-center " colspan="5">
                                                                <p class="font-weight-bold">No coupns available</p>

                                                            </td>
                                                        </tr>
                                                        <%}%>
                                                            <!-- Add more rows as needed -->
                                </tbody>
                            </table>
                        </div>

                    </div>

                    <div class="modal-footer" style="justify-content: space-around;">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!--Scoll Top-->
        <span id="site-scroll"><i class="icon anm anm-angle-up-r"></i></span>
        <!--End Scoll Top-->

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <!-- Including Jquery -->
        <script src="user/assets/js/vendor/jquery-3.3.1.min.js"></script>
        <script src="user/assets/js/vendor/jquery.cookie.js"></script>
        <script src="user/assets/js/vendor/modernizr-3.6.0.min.js"></script>
        <script src="user/assets/js/vendor/wow.min.js"></script>
        <!-- Including Javascript -->
        <script src="user/assets/js/bootstrap.min.js"></script>
        <script src="user/assets/js/plugins.js"></script>
        <script src="user/assets/js/popper.min.js"></script>
        <script src="user/assets/js/lazysizes.js"></script>
        <script src="user/assets/js/main.js"></script>



        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script src="user/assets/js/custom/checkout.js"></script>
        </div>
        </body>

        <!-- belle/cart-variant1.html   11 Nov 2019 12:44:32 GMT -->

        </html>