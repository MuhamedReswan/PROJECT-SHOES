<%- include('../layout/user/header.ejs') -%>
<div class="pageWrapper">
    <div class="row">
        <div class="col-lg-12 d-flex justify-content-center align-items-center mt-4">
<%if(address){%>
 
    
    <div id="addAddress" class="create-ac-content bg-light-gray padding-20px-all my-auto">
        <!-- <form action="/add-address" method="post" onsubmit="return addAddressValidation()"> -->
            <fieldset>
                <h2 class="login-title mb-3">Delivery Address</h2>
                <div id="error-container" class="text-center text-danger"></div>
                <div class="row">
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-firstname">Full Name <span
                                class="required-f">*</span></label>
                        <input name="name" value="<%= address.name %>" data-id="<%= address._id %>" id="input-firstname" type="text">
                    </div>

                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-telephone">Mobile <span
                                class="required-f">*</span></label>
                        <input name="mobile" value="<%= address.mobile %>" id="input-telephone" type="text">
                    </div>
                </div>

            </fieldset>

            <fieldset>
                <div class="row">
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-address-1">Address <span
                                class="required-f">*</span></label>
                        <input name="address" value="<%= address.address %>" id="input-address-1" type="text">
                    </div>
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-city">City <span class="required-f">*</span></label>
                        <input name="city" value="<%= address.city %>" id="input-city" type="text">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-md-6 col-lg-6 col-xl-6">
                        <label for="input-district">District <span
                                class="required-f">*</span></label>
                        <input name="district" value="<%= address.district %>" id="input-district" type="text">
                    </div>
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-state">State <span class="required-f">*</span></label>
                        <select name="state" id="input-state">
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala" selected>Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar
                                Islands</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli
                            </option>
                            <option value="Daman and Diu">Daman and Diu</option>
                            <option value="Lakshadweep">Lakshadweep</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Puducherry">Puducherry</option>
                        </select>

                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-postcode">Post Code <span
                                class="required-f">*</span></label>
                        <input name="pincode" value="<%= address.pincode %>" id="input-postcode" type="text">
                    </div>
                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                        <label for="input-country">Country <span
                                class="required-f">*</span></label>
                        <select name="country" id="input-country">
                            <option value="India" selected>India</option>
                        </select>
                    </div>
                </div>
                <div class="row d-flex justify-content-center">
                    <button  id="submit-button" type="submit" class="btn">submit</button>
                </div>
            </fieldset>
        <!-- </form> -->
    </div>   <%}else{%>
        <div class="row text-center">
            <h1>no address getting</h1>
        </div>
        
        <%}%>


    </div>
    </div>

</div>
<script>

let submit = document.getElementById('submit-button');
submit.addEventListener('click',addAddressValidation);

    function addAddressValidation() {
        event.preventDefault(); // Prevent form submission if validation fails
        console.log('im add-address validation');
        // Get form fields
        const name = document.getElementById('input-firstname').value.trim();
        const id = document.getElementById('input-firstname').getAttribute('data-id')
        const mobile = document.getElementById('input-telephone').value.trim();
        const address = document.getElementById('input-address-1').value.trim();
        const district = document.getElementById('input-district').value.trim();
        const city = document.getElementById('input-city').value.trim();
        const pincode = document.getElementById('input-postcode').value.trim();
        const state = document.getElementById('input-state').value.trim();
        const country = document.getElementById('input-country').value.trim();

        // Regular expressions for validation
        const nameRegex =/^(?!.*\d)[^\W\d]\w*$/;
        const mobileRegex = /^\d{10}$/;
        const textRegex = /^[^\d]+$/;
        const pincodeRegex = /^\d{6}$/;

        // Error messages
        const errors = [];

        // Validate each field
        if (!nameRegex.test(name) || name == '') {
            errors.push('Please enter a proper name');
            document.getElementById('input-firstname').classList.add('error');
            displayErrors(errors);
            return false;
        }

        if (!mobileRegex.test(mobile) || mobile.length > 10 || mobile.length < 10) {
            errors.push('Mobile number should be 10 digits.');
            document.getElementById('input-telephone').classList.add('error');
            displayErrors(errors);
            return false;
        }


        if (!textRegex.test(address) || address == '') {
            errors.push('Please enter a valid address');
            document.getElementById('input-address-1').classList.add('error');
            displayErrors(errors);
            return false;
        }

        if (!textRegex.test(district) || district == '') {
            errors.push('Please enter a valid distric name.');
            document.getElementById('input-district').classList.add('error');
            displayErrors(errors);
            return false;
        }

        if (!textRegex.test(city) || city == '') {
            errors.push('Please enter a valid city name.');
            document.getElementById('input-city').classList.add('error');
            displayErrors(errors);
            return false;
        }

        if (!pincodeRegex.test(pincode) || pincode == '') {
            errors.push('Pincode should be 6 digits.');
            document.getElementById('input-postcode').classList.add('error');
            displayErrors(errors);
            return false;
        }

        // If all validations pass, return true
        console.log('validation success');       

let data={name, mobile, address, district, city, pincode, country, state, id }

        fetch('/edit-address',{
            method:'Post',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(data)
        })
        .then(res=> res.json())
        .then((res)=>{
           if(res.success){
            setTimeout(() => {
                window.location.href = '/profile'
            }, 1000);
            
           }
        })
    }

    function displayErrors(errors) {
        // Display error messages
        const errorContainer = document.getElementById('error-container');
        errorContainer.innerHTML = errors.map(error => `<strong><p class="text-danger">${error}</p></strong>`).join('');
        errorContainer.style.display = 'block';
        setTimeout(() => {
            errorContainer.innerHTML = ""
        }, 3000)
    }

    // Remove error class on input focus
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('focus', () => {
            input.classList.remove('error');
            document.getElementById('error-container').style.display = '';
        });
    });
</script>

<%- include('../layout/user/footer.ejs') -%>
